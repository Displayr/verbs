context("Subscripting QStatisticsTestingInfo and other manipulations")

table.Age.by.Income <- structure(c(34.7826086956522, 0, 0, 8.69565217391304, 0, 0, 0,
        47.8260869565217, 8.69565217391304, 100, 19.4805194805195, 6.49350649350649,
        0, 7.79220779220779, 16.8831168831169, 3.8961038961039, 9.09090909090909,
        20.7792207792208, 15.5844155844156, 100, 16.4383561643836, 5.47945205479452,
        8.21917808219178, 9.58904109589041, 4.10958904109589, 8.21917808219178,
        12.3287671232877, 26.027397260274, 9.58904109589041, 100, 13.953488372093,
        6.97674418604651, 16.2790697674419, 10.077519379845, 7.75193798449612,
        12.4031007751938, 10.8527131782946, 4.65116279069767, 17.0542635658915,
        100, 8.22784810126582, 11.3924050632911, 8.86075949367089, 8.22784810126582,
        20.253164556962, 8.86075949367089, 16.4556962025316, 16.4556962025316,
        1.26582278481013, 100, 7.76699029126214, 27.1844660194175, 11.6504854368932,
        18.4466019417476, 6.79611650485437, 2.9126213592233, 15.5339805825243,
        9.70873786407767, 0, 100, 6.77966101694915, 10.1694915254237,
        16.9491525423729, 6.77966101694915, 10.1694915254237, 13.5593220338983,
        10.1694915254237, 25.4237288135593, 0, 100, 4.54545454545455,
        11.3636363636364, 11.3636363636364, 29.5454545454545, 6.81818181818182,
        9.09090909090909, 4.54545454545455, 22.7272727272727, 0, 100,
        17.0731707317073, 17.0731707317073, 14.6341463414634, 7.31707317073171,
        14.6341463414634, 0, 14.6341463414634, 14.6341463414634, 0, 100,
        12.3055162659123, 11.5983026874116, 10.4667609618105, 11.3154172560113,
        11.3154172560113, 7.63790664780764, 12.1640735502122, 16.8316831683168,
        6.36492220650637, 100), statistic = "Column %", dim = c(10L, 10L),
        dimnames = list(c("18 to 24", "25 to 29", "30 to 34", "35 to 39",
        "40 to 44", "45 to 49", "50 to 54", "55 to 64", "65 or more",
        "NET"), c("Less than $15,000", "$15,001 to $30,000", "$30,001 to $45,000",
        "$45,001 to $60,000", "$60,001 to $90,000", "$90,001 to $120,000",
        "$120,001 to $150,000", "$150,001 to $200,000", "$200,001 or more",
        "NET")), class = c("matrix", "array", "QTable"), dimnets = list(
        10L, 10L), dimduplicates = list(10L, 10L), span = list(rows = structure(list(
        c("18 to 24", "25 to 29", "30 to 34", "35 to 39", "40 to 44",
        "45 to 49", "50 to 54", "55 to 64", "65 or more", "NET")), class = "data.frame", names = "", row.names = c(NA,
        10L)), columns = structure(list(c("Less than $15,000", "$15,001 to $30,000",
        "$30,001 to $45,000", "$45,001 to $60,000", "$60,001 to $90,000",
        "$90,001 to $120,000", "$120,001 to $150,000", "$150,001 to $200,000",
        "$200,001 or more", "NET")), class = "data.frame", names = "", row.names = c(NA, 10L))),
        basedescriptiontext = "sample size = 707; total sample size = 800; 93 missing",
        basedescription = list(Minimum = 707L, Maximum = 707L, Range = FALSE, Total = 800L,
        Missing = 93L, EffectiveSampleSize = 707L, EffectiveSampleSizeProportion = 100,
        FilteredProportion = 0), QStatisticsTestingInfo = structure(list(
        significancearrowratio = structure(c(0.588688946015424, 0.246786632390746,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0,
        0.465295629820051, 0, 0.246786632390746, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0.246786632390746, 0, 0.74293059125964, 0,
        0, 0, 0, 0.246786632390746, 0, 0.74293059125964, 0, 0, 0,
        0, 0, 0, 0, 0, 0.246786632390746, 0, 0, 0, 0, 0, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0.74293059125964, 0, 0.246786632390746,
        0.74293059125964, 0, 0.246786632390746, 0, 0, 0, 0, 0, 0.588688946015424,
        0, 1, 0.465295629820051, 0.465295629820051, 0.246786632390746,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0), dim = 100L), significancedirection = structure(c("Up",
        "Up", "None", "None", "None", "None", "None", "None", "None",
        "None", "None", "None", "None", "None", "None", "Up", "None",
        "None", "None", "None", "None", "Down", "None", "Up", "None",
        "None", "None", "None", "None", "None", "None", "None", "None",
        "None", "None", "Up", "None", "Up", "None", "None", "None",
        "None", "Down", "None", "Up", "None", "None", "None", "None",
        "None", "None", "None", "None", "Up", "None", "None", "None",
        "None", "None", "None", "None", "None", "None", "None", "None",
        "None", "None", "None", "None", "None", "Up", "None", "Up",
        "Down", "None", "Down", "None", "None", "None", "None", "None",
        "Up", "None", "Up", "Down", "Down", "Down", "None", "None",
        "None", "None", "None", "None", "None", "None", "None", "None",
        "None", "None", "None"), dim = 100L), significancefontsizemultiplier = structure(c(3.29,
        1.96, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 4.89, 1, 1,
        1, 1, 1, 0.355871886120996, 1, 1.96, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1.96, 1, 3.89, 1, 1, 1, 1, 0.510204081632653,
        1, 3.89, 1, 1, 1, 1, 1, 1, 1, 1, 1.96, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 3.89, 1, 1.96, 0.25706940874036,
        1, 0.510204081632653, 1, 1, 1, 1, 1, 3.29, 1, 4.89, 0.355871886120996,
        0.355871886120996, 0.510204081632653, 1, 1, 1, 1, 1, 1, 1,
        1, 1, 1, 1, 1, 1), dim = 100L), significanceissignificant = structure(c(TRUE,
        TRUE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE,
        FALSE, FALSE, FALSE, FALSE, FALSE, TRUE, FALSE, FALSE, FALSE,
        FALSE, FALSE, TRUE, FALSE, TRUE, FALSE, FALSE, FALSE, FALSE,
        FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, TRUE, FALSE,
        TRUE, FALSE, FALSE, FALSE, FALSE, TRUE, FALSE, TRUE, FALSE,
        FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, TRUE, FALSE,
        FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE,
        FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, TRUE, FALSE, TRUE,
        TRUE, FALSE, TRUE, FALSE, FALSE, FALSE, FALSE, FALSE, TRUE,
        FALSE, TRUE, TRUE, TRUE, TRUE, FALSE, FALSE, FALSE, FALSE,
        FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE),
        dim = 100L), significanceargbcolor = structure(c(-16776961L,
        -16776961L, -8355712L, -8355712L, -8355712L, -8355712L, -8355712L,
        -8355712L, -8355712L, -8355712L, -8355712L, -8355712L, -8355712L,
        -8355712L, -8355712L, -16776961L, -8355712L, -8355712L, -8355712L,
        -8355712L, -8355712L, -65536L, -8355712L, -16776961L, -8355712L,
        -8355712L, -8355712L, -8355712L, -8355712L, -8355712L, -8355712L,
        -8355712L, -8355712L, -8355712L, -8355712L, -16776961L, -8355712L,
        -16776961L, -8355712L, -8355712L, -8355712L, -8355712L, -65536L,
        -8355712L, -16776961L, -8355712L, -8355712L, -8355712L, -8355712L,
        -8355712L, -8355712L, -8355712L, -8355712L, -16776961L, -8355712L,
        -8355712L, -8355712L, -8355712L, -8355712L, -8355712L, -8355712L,
        -8355712L, -8355712L, -8355712L, -8355712L, -8355712L, -8355712L,
        -8355712L, -8355712L, -8355712L, -16776961L, -8355712L, -16776961L,
        -65536L, -8355712L, -65536L, -8355712L, -8355712L, -8355712L,
        -8355712L, -8355712L, -16776961L, -8355712L, -16776961L,
        -65536L, -65536L, -65536L, -8355712L, -8355712L, -8355712L,
        -8355712L, -8355712L, -8355712L, -8355712L, -8355712L, -8355712L,
        -8355712L, -8355712L, -8355712L, -8355712L), dim = 100L),
        backgroundargbcolor = structure(c(0L, 0L, 0L, 0L, 0L, 0L,
        0L, 0L, 0L, 0L, 0L, 0L, 0L, 0L, 0L, 0L, 0L, 0L, 0L, 0L, 0L,
        0L, 0L, 0L, 0L, 0L, 0L, 0L, 0L, 0L, 0L, 0L, 0L, 0L, 0L, 0L,
        0L, 0L, 0L, 0L, 0L, 0L, 0L, 0L, 0L, 0L, 0L, 0L, 0L, 0L, 0L,
        0L, 0L, 0L, 0L, 0L, 0L, 0L, 0L, 0L, 0L, 0L, 0L, 0L, 0L, 0L,
        0L, 0L, 0L, 0L, 0L, 0L, 0L, 0L, 0L, 0L, 0L, 0L, 0L, 0L, 0L,
        0L, 0L, 0L, 0L, 0L, 0L, 0L, 0L, 0L, 0L, 0L, 0L, 0L, 0L, 0L,
        0L, 0L, 0L, 0L), dim = 100L), zstatistic = structure(c(3.33618133491949,
        2.03034966181107, 1.13511282954117, 0.630165237548994, -1.77063033919422,
        -1.51701060908344, -1.34962047042048, -1.6181113312432, 0.957487771112176,
        NaN, -1.76608861777883, -1.48195726966089, -1.72412535526839,
        -1.81301574886364, -0.0917225018893063, 5.34467807957311,
        -0.35801030122794, -0.0501998627447907, 1.12800404194274,
        NaN, -1.66709204405053, -3.17832862726785, -0.662435994133139,
        2.38501448988396, -0.7483413017028, 0.424582584355787, 1.69896788855474,
        0.200684159017596, 0.89811072647808, NaN, -0.403226042324786,
        -1.03386517935973, -0.491702694295788, -0.490869570467291,
        -1.39030287760437, 2.47179348899936, -1.14878449758381, 3.94191711057016,
        -0.832693809525245, NaN, -1.74163361004133, 1.6338088418349,
        -2.05234828292484, -1.41304349337351, 4.02458217744348, -1.56646877956805,
        -0.290232024231005, -0.972446136076137, 0.691157415671514,
        NaN, -1.40212219261521, -1.30957877621858, 0.197456498806599,
        2.25365370786559, 0.656738111820661, -1.95345687155279, 1.78870895336723,
        0.374724051262546, -1.89716371573842, NaN, -1.81446668897194,
        -0.873966900104256, 0.0454598028454102, -0.503949578712891,
        1.87282843753458, 1.13201493826764, -0.489580936488417, -1.59654044426236,
        0.498538451671911, NaN, 4.03911418475605, 0.980772638284431,
        2.21752864240068, -4.0894391990541, -0.14334486430662, -2.09038716182298,
        1.84247691606585, 1.0793537184846, -0.387487727907263, NaN,
        0.465502155580113, 3.51055687636972, 1.19157592018314, 5.5001654195619,
        -2.9794062208591, -2.86277431544593, -2.09182559187289, -1.78589755668656,
        -1.72005281705997, NaN, NaN, NaN, NaN, NaN, NaN, NaN, NaN,
        NaN, NaN, NaN), dim = 100L), pcorrected = structure(c(0.000849377419153474,
        0.0423210095424223, 0.256328046748208, 0.528586480556088,
        0.0766221933689186, 0.129264005505931, 0.177137754498547,
        0.105638606959378, 0.338321115867427, NaN, 0.0773809827461264,
        0.138351665068541, 0.0846852156976564, 0.0698293923241086,
        0.926918518829267, 9.05778875237573e-08, 0.720335604552778,
        0.959963120931475, 0.259318212136639, NaN, 0.0954961038909552,
        0.00148126755068367, 0.507691842184744, 0.0170784486631649,
        0.454254318229909, 0.671140990940982, 0.0893252341570526,
        0.840945546998515, 0.369126520991046, NaN, 0.686781943204848,
        0.301199195429941, 0.62292953328991, 0.623518700409737, 0.16443692441598,
        0.0134437150729616, 0.250644853277108, 0.0000808329136292585,
        0.405017436714764, NaN, 0.0815725762954532, 0.102298995198857,
        0.0401358267826595, 0.157642936167409, 0.0000570765610781176,
        0.117238912014026, 0.771638738277393, 0.330828649229419,
        0.489466621817869, NaN, 0.160878761024438, 0.190338372185203,
        0.843470320141708, 0.0242179617346248, 0.51134932415577,
        0.0507654829575195, 0.0736617002828646, 0.707865703158119,
        0.0578063340496739, NaN, 0.0696059066711372, 0.382136279730124,
        0.963740814436351, 0.614296809388373, 0.0610920797125845,
        0.257628154136641, 0.624430468982927, 0.110368183500707,
        0.618104574183931, NaN, 0.0000536534428476898, 0.326704874125211,
        0.0265869880109406, 0.0000432417394942153, 0.886017825067399,
        0.0365830352009795, 0.0654054200653444, 0.280430074299729,
        0.698395168435894, NaN, 0.641571893614577, 0.000447169134715319,
        0.233427571493747, 3.79435104447268e-08, 0.00288807619190024,
        0.00419949566936639, 0.0364541201647898, 0.0741158466703972,
        0.0854228412526985, NaN, NaN, NaN, NaN, NaN, NaN, NaN, NaN,
        NaN, NaN, NaN), dim = 100L)), class = "data.frame", row.names = c(NA,
        100L)), questiontypes = c("PickOne", "PickOne"),
        footerhtml = "Age by Income&lt;br /&gt;sample size = 707; total sample size = 800; 93 missing; 95% confidence level",
        name = "Age by Income", questions = c("Age", "Income"))



test_that("Subscripting and renaming works on QStatistingTestingInfo",
{
    assign("ALLOW.QTABLE.CLASS", TRUE, envir = .GlobalEnv)
    mytable <- table.Age.by.Income
    mytable = mytable[,]
    rownames(mytable) = paste(rownames(mytable),"HELLO")
    mytable = mytable[1:4,]
    expect_equal(attr(mytable, "QStatisticsTestingInfo")$Row,
        structure(c(1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 2L, 2L, 2L,
        2L, 2L, 2L, 2L, 2L, 2L, 2L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L,
        3L, 4L, 4L, 4L, 4L, 4L, 4L, 4L, 4L, 4L, 4L), levels = c("18 to 24 HELLO",
        "25 to 29 HELLO", "30 to 34 HELLO", "35 to 39 HELLO"), class = "factor"))
    expect_equal(attr(mytable, "QStatisticsTestingInfo")$backgroundargbcolor,
        structure(c(0L, 0L, 0L, 0L, 0L, 0L, 0L, 0L, 0L, 0L, 0L, 0L, 0L,
        0L, 0L, 0L, 0L, 0L, 0L, 0L, 0L, 0L, 0L, 0L, 0L, 0L, 0L, 0L, 0L,
        0L, 0L, 0L, 0L, 0L, 0L, 0L, 0L, 0L, 0L, 0L), dim = 40L))
    remove(ALLOW.QTABLE.CLASS, envir = .GlobalEnv)
})
